<!-- start: BREADCRUMB -->
<div class="breadcrumb-wrapper">
  <h4 class="mainTitle no-margin">Helper Report</h4>

  <div ng-click="vm.breadcrumbRoute()" ncy-breadcrumb class="pull-right"></div>
</div>
<!-- end: BREADCRUMB -->

<div class="container-fluid container-fullw" style="min-height:550px;">
  <div class="row" ng-show="vm.errorMessage">
    <div class="col-md-12">
      <div class="alert alert-danger">
        <button class="close" ng-click="vm.hideAlertBox()">
          &times;
        </button>
        <strong>Error!</strong> {{vm.errorMessage}}
      </div>
    </div>
  </div>
  <div class="row" ng-show="vm.message">
    <div class="col-md-12">
      <div class="alert alert-success">
        <button class="close" ng-click="vm.hideAlertBox()">
          &times;
        </button>
        {{vm.message}}
      </div>
    </div>
  </div>

  <div class="row">
    <div class="col-md-12">
      <div class="panel panel-white">
        <div class="panel-body">
          <ng-form name="vm.Form" role="Form" id="Form" class="form-inline" novalidate>
              <div class="row">

                <div class="col-md-4 col-lg-4">
                  <div class="form-group">
                    <label class="control-label">
                      Type : <span class="symbol required"></span>
                    </label><br>
                    <div ng-class="{'has-error':vm.Form.type.$dirty && vm.Form.type.$invalid, 'has-success':vm.Form.type.$valid}">
                      <select class="form-control" style="width:250px;" name="type" ng-model="vm.helper.helperType" ng-change="vm.hideTable()" required>
                        <option>Helper</option>
                        <option>Working helpers</option>
                        <option>Non-working helpers</option>
                      </select>
                      <span class="error text-small block"
                            ng-if="vm.Form.type.$dirty && vm.Form.type.$error.required">Type is required.</span>
                    </div>
                  </div>
                </div>

                <div class="col-md-4 col-lg-4" ng-if="vm.helper.helperType == 'Helper'">
                <div class="form-group"
                     ng-class="{'has-error':vm.Form.searchBy.$dirty && vm.Form.searchBy.$invalid, 'has-success':vm.Form.searchBy.$valid}">
                  <label class="control-label block"> Search By </label>
                  <div class="clip-radio radio-primary">
                    <input type="radio" id="searchByName" ng-click="vm.hideNumber()" name="searchBy" value="Helper Name" ng-model="vm.searchByName">
                    <label for="searchByName"> Name </label>
                    <input type="radio" id="searchBynumber" ng-click="vm.hideName()" name="searchBy" value="Helper Number" ng-model="vm.searchBynumber">
                    <label for="searchBynumber"> Helper Number </label>
                  </div>
                </div>
                </div>

                <div class="col-md-4 col-lg-4" ng-if="vm.searchBynumber && vm.showNumberQuery && vm.helper.helperType=='Helper'">
                  <div class="form-group">
                    <label class="control-label">
                    Number : <span class="symbol required"></span>
                    </label><br>
                    <div ng-class="{'has-error':vm.Form.helperNo.$dirty && vm.Form.helperNo.$invalid, 'has-success':vm.Form.helperNo.$valid}">
                      <input type="text" style="width:250px;" placeholder="Enter Helper Number" ng-change="vm.hideTable()" class="form-control" name="helperNo"
                      ng-model="vm.helper.number"  ng-pattern="/^[1-9][0-9]*$/" ng-minlength="6" ng-maxlength="6" required/>
                      <span class="error text-small block" ng-if="vm.Form.helperNo.$error.pattern">Invalid characters</span>
                      <span class="error text-small block" ng-if="vm.Form.helperNo.$dirty && vm.Form.helperNo.$error.required">Helper number is required</span>
                      <span class="error text-small block" ng-if="!vm.Form.helperNo.$error.pattern && vm.Form.helperNo.$error.minlength">Helper number is of 6 digits</span>
                      <span class="error text-small block" ng-if="!vm.Form.helperNo.$error.pattern && vm.Form.helperNo.$error.maxlength">Helper number should be of 6 digits</span>
                    </div>
                  </div>
                </div>

                <div class="col-md-4 col-lg-4" ng-if="vm.searchByName && vm.showNameText && vm.helper.helperType=='Helper'">
                  <div class="form-group" ng-class="{'has-error':vm.Form.name.$dirty && vm.Form.name.$invalid, 'has-success':vm.Form.name.$valid}">
                    <label class="control-label">
                      Name <span class="symbol required"></span>
                    </label>
                    <div class="row">
                      <div class="col-md-7">
                        <input type="text" ng-model="vm.helper.name" placeholder="Search Helper" name="name"
                               ng-value="vm.helper.name" style="width:250px;" ng-pattern="/^[a-zA-Z\s]*$/"
                               uib-typeahead="item.name for item in vm.helperNameList($viewValue)"
                               typeahead-loading="loadingLocations" typeahead-min-length="3" typeahead-no-results="noResults"
                               typeahead-on-select="vm.onSelect($item, $model, $label)"
                               typeahead-editable='true' ng-change="vm.hideTableData()"
                               class="form-control" required/>
                      </div>
                      <div class="col-md-5">
                        <span class="btn btn-danger" style="margin-left: 45px;" ng-click="vm.clearFlat()" ><i
                          class="fa fa-times"></i> </span>
                      </div>
                    </div>
                    <div ng-show="noResults" class="error">
                      <i class="glyphicon glyphicon-remove"></i> No Results Found
                    </div>
                    <span class="error text-small block"
                          ng-if="vm.Form.name.$dirty && vm.Form.name.$error.required">Name is required.</span>
                    <span class="error text-small block"
                          ng-if="vm.Form.name.$error.pattern">Invalid Characters</span>
                  </div>
                </div>

                <div class="col-md-4 col-lg-4" ng-if="vm.helper.helperType != 'Helper'">
                  <button type="button" class="btn btn-primary" style="margin-top:18px; width:150px;" ng-click="vm.generate()">
                    Generate Report
                  </button>
                </div>
              </div>


            <div class="row"  ng-if="vm.helper.helperType == 'Helper'">
              <div class="col-md-4 col-lg-4">
                <button type="button" class="btn btn-primary" style="margin-top:18px; width:150px;" ng-click="vm.generate()">
                  Generate Report
                </button>
              </div>
            </div>
          </ng-form>

        </div>
      </div>
    </div>
  </div>

  <wave-spinner ng-show="vm.reportProgress" ></wave-spinner>

  <div class="row" ng-show="vm.IsHidden">
    <div class="col-md-12">
      <div class="panel panel-white">
        <div class="panel-body">

          <table ng-table="vm.tableParams" show-filter="true" class="table table-striped table-bordered">
            <tr ng-repeat="row in $data">

              <td data-title="'Helper number'" ng-if="vm.helper.helperType =='Working helpers' || vm.helper.helperType == 'Non-working helpers'" style="width:150px;" sortable="'helperNo'" filter="{ 'helperNo' : 'text' }">{{row.helperNo}}</td>
              <td data-title="'Name'">{{row.name}}</td>
              <td data-title="'Mobile'">{{row.mobile}}</td>
              <td data-title="'Aadhaar Id'">{{row.aadhaarId}}</td>
              <td data-title="'Type'" style="width:150px;" sortable="'type'" filter="{ 'type' : 'text' }">{{row.type}}</td>
              <td data-title="'Gender'">{{row.gender}}</td>
              <td data-title="'Verification Done'">{{row.policeVerificationDone}}</td>
              <td data-title="'Working'" ng-if="vm.helper.helperType == 'Helper'">{{!row.isNotWorking}}</td>
              <td data-title="'Working At'" ng-if="vm.helper.helperType == 'Helper'">
                <div ng-repeat="temp in row.workingAt" ng-if="temp.endDate>vm.currentDate">{{temp.tower}} {{temp.flatNo}}</div>
              </td>
              <td data-title="'Worked At'" ng-if="vm.helper.helperType == 'Helper'">
                <div ng-repeat="temp in row.workingAt" ng-if="vm.currentDate>temp.endDate">{{temp.tower}} {{temp.flatNo}}</div>
              </td>
              <td data-title="'Resident Address'" ng-if="vm.helper.helperType == 'Working helpers'">
                <div ng-repeat="temp in row.workingAt">{{temp.tower}} {{temp.flatNo}}</div>
              </td>
              <td data-title="'Worked At'" ng-if="vm.helper.helperType == 'Non-working helpers'">
                <div ng-repeat="temp in row.workingAt" ng-if="vm.currentDate>temp.endDate">{{temp.tower}} {{temp.flatNo}}</div>
              </td>

            </tr>
          </table>
        </div>
      </div>
    </div>
  </div>
</div>

